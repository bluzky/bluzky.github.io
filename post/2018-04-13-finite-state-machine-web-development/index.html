<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  
  <title>Finite state machine trong lập trình</title>
  <meta property="og:title" content="Finite state machine trong lập trình" />
  <meta name="twitter:title" content="Finite state machine trong lập trình" />
  <meta name="description" content="1. Tìm hiểu về FSM  FSM(Finite state machine) - Máy trạng thái hữu hạn là một mô hình toán học biểu diễn trạng thái của hệ, trong đó số trạng thái là hữu hạn. Từ mỗi trạng thái, máy có thể chuyển đổi qua 1 số trạng thái cố định khác, dựa trên các sự kiện, input.
 Fsm được biểu diễn như 1 đồ thị có hướng.">
  <meta property="og:description" content="1. Tìm hiểu về FSM  FSM(Finite state machine) - Máy trạng thái hữu hạn là một mô hình toán học biểu diễn trạng thái của hệ, trong đó số trạng thái là hữu hạn. Từ mỗi trạng thái, máy có thể chuyển đổi qua 1 số trạng thái cố định khác, dựa trên các sự kiện, input.
 Fsm được biểu diễn như 1 đồ thị có hướng.">
  <meta name="twitter:description" content="1. Tìm hiểu về FSM  FSM(Finite state machine) - Máy trạng thái hữu hạn là một mô hình toán học biểu diễn trạng thái của hệ, trong đó số trạng thái là hữu hạn. Từ mỗi trạng thái, máy có thể chuyển đổi …">
  <meta name="author" content="Dũng Nguyễn" />
  <link href='http://bluzky.github.io/img/favicon.ico' rel='icon' type='image/x-icon' />
  <meta property="og:image" content="http://bluzky.github.io/img/avatar-icon.png" />
  <meta name="twitter:image" content="http://bluzky.github.io/img/avatar-icon.png" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@username" />
  <meta name="twitter:creator" content="@username" />
  <meta property="og:url" content="http://bluzky.github.io/post/2018-04-13-finite-state-machine-web-development/" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="The 54 tribes" />
  
  <meta name="generator" content="Hugo 0.32.4" />
  <link rel="canonical" href="http://bluzky.github.io/post/2018-04-13-finite-state-machine-web-development/" />
  <link rel="alternate" href="http://bluzky.github.io/index.xml" type="application/rss+xml" title="The 54 tribes">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css" integrity="sha384-wITovz90syo1dJWVh32uuETPVEtGigN07tkttEqPv+uR2SE/mbQcG7ATL28aI9H0" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
  <link rel="stylesheet" href="/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="http://bluzky.github.io/css/main.css" />
  <link href="https://fonts.googleapis.com/css?family=Merriweather:400,700" rel="stylesheet">

  <link rel="stylesheet" href="http://bluzky.github.io/css/codeblock.css" />
  <link rel="stylesheet" href="http://bluzky.github.io/css/prism.css" />



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe.min.css" integrity="sha256-sCl5PUOGMLfFYctzDW3MtRib0ctyUvI9Qsmq2wXOeBY=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/default-skin/default-skin.min.css" integrity="sha256-BFeI1V+Vh1Rk37wswuOYn5lsTcaU96hGaI7OUVCLjPc=" crossorigin="anonymous" />



<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div> 
</head>

  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="http://bluzky.github.io">The 54 tribes</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="Blog" href="/">Blog</a>
            </li>
          
        
          
            <li class="navlinks-container">
              <a class="navlinks-parent" href="javascript:void(0)">#tags</a>
              <div class="navlinks-children">
                
                  <a href="/tags/python">#python</a>
                
                  <a href="/tags/elixir">#elixir</a>
                
                  <a href="/tags/javascript">#js</a>
                
                  <a href="/tags/golang">#go</a>
                
                  <a href="/tags/til">#til</a>
                
                  <a href="/tags">All tags</a>
                
              </div>
            </li>
          
        
          
            <li>
              <a title="About" href="/page/about/">About</a>
            </li>
          
        

        

        
      </ul>
    </div>

    <div class="avatar-container">
      <div class="avatar-img-border">
        
          <a title="The 54 tribes" href="http://bluzky.github.io">
            <img class="avatar-img" src="http://bluzky.github.io/img/avatar-icon.png" alt="The 54 tribes" />
          </a>
        
      </div>
    </div>

  </div>
</nav>




    
  
  
  




  

  <header class="header-section ">
    
    <div class="intro-header no-img">
      
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              <h2 class="text-center">Finite state machine trong lập trình</h2>
                
                  <div class="text-center">
                    <span class="post-meta">
  
  <i class="fa fa-clock-o"></i> 4 min (800 words)
  
  
</span>

                    
                    <span class="post-meta" style="margin-left: 15px;"> <i class="fa fa-tag"></i> 
                          
                            #<a href="http://bluzky.github.io/tags/elixir/">elixir</a>&nbsp;
                          
                            #<a href="http://bluzky.github.io/tags/tech/">tech</a>&nbsp;
                          
                    </span> 
                  </div>
                
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        

<h2 id="1-tìm-hiểu-về-fsm">1. Tìm hiểu về FSM</h2>

<blockquote>
<p><a href="https://vi.wikipedia.org/wiki/M%C3%A1y_tr%E1%BA%A1ng_th%C3%A1i_h%E1%BB%AFu_h%E1%BA%A1n">FSM(Finite state machine)</a> - Máy trạng thái hữu hạn là một mô hình toán học biểu diễn trạng thái của hệ, trong đó số trạng thái là hữu hạn. Từ mỗi trạng thái, máy có thể chuyển đổi qua 1 số trạng thái cố định khác, dựa trên các sự kiện, input.</p>
</blockquote>

<p>Fsm được biểu diễn như 1 đồ thị có hướng.</p>

<p><strong>Ví dụ</strong>:</p>

<p>Máy trạng thái thể hiện trạng thái của 1 bài báo trên trang tin tức</p>

<p><img src="/img/fsm_post.png" alt="fsm" /></p>

<ul>
<li><code>draft</code>, <code>in review</code> <code>published</code> là các trạng thái của bài viết</li>
<li><code>review</code>, <code>approve</code>, <code>reject</code>, <code>unpublish</code> là các sự kiện( event ). Các sự kiện này phát sinh khi nhận các input như click lên button, … Các sự kiện này gây ra việc chuyển trạng thái (ví dụ từ Draft -&gt; In review), gọi là quá trình chuyển đổi (<code>transition</code>)</li>
</ul>

<p><strong>Đặc điểm</strong></p>

<p>Trong mô hình sử dụng <code>DFS</code> máy  trạng thái đơn định.</p>

<ul>
<li>Tại mỗi thời điểm  máy chỉ ở 1 trạng thái duy nhất</li>
<li>Tại mỗi trạng thái, chỉ có thể chuyển qua những trạng thái được cho phép</li>
<li>Từ trạng thái hiện tại, có thể biết được những trạng thái kế tiếp mà máy có thể chuyển qua</li>
</ul>

<h2 id="2-ứng-dụng-của-fsm-trong-lập-trình">2. Ứng dụng của FSM trong lập trình</h2>

<ul>
<li><p>FSM mô tả các trạng thái, sự kiện và quá trình chuyển đổi giữa các trạng thái, nên FSM có thể được sử dụng để quản lý trạng thái của object, hoặc workflow.</p></li>

<li><p>Ví dụ: Quản lý trạng thái đơn hàng, quản lý trạng thái của ticket, quản lý trạng thái của nhân vật trong game, &hellip;</p></li>
</ul>

<p>​</p>

<p>Trong ví dụ trên, mỗi bài viết, chỉ có thể có một trạng thái tại một thời điểm, và từ 1 trạng thái chỉ có thể chuyển đổi qua một số trạng thái được quy định trước:</p>

<ul>
<li>Từ <code>draft</code> chỉ có thể chuyển qua <code>in review</code></li>
<li>Từ <code>draft</code> không thể chuyển qua <code>published</code></li>
</ul>

<h3 id="2-1-khi-không-dùng-fsm">2.1 Khi không dùng FSM</h3>

<p>Khi không sử dụng FSM thì code sẽ phải dùng tới rất nhiều điều kiện <code>if … else…</code> hoặc <code>case</code> (<code>switch ... case …</code> trong các ngôn ngữ khác)</p>

<pre><code class="language-elixir">defmodule Post do
	defstruct content: &quot;sample content&quot;, status: &quot;draft&quot;
	
	def all_status, do: [&quot;draft&quot;, &quot;in_review&quot;, &quot;published&quot;]
    
    def update_status(%{status: &quot;draft&quot;} = post, status) do
    	if status == &quot;in_review&quot; do
        	IO.put(&quot;Update post status to in_review&quot;)
        	Map.put(post, :status, &quot;in_review&quot;)
        else
        	IO.put(&quot;Cannot update to #{status} from draft&quot;)
        	post
        end
    end
    
    def update_status(%{status: &quot;in_review&quot;} = post, status) do
    	case status do
			&quot;draft&quot; -&gt;
	    		IO.put(&quot;Reject the post&quot;)
    	    	Map.put(post, :status, &quot;draft&quot;)
    	    
    	    &quot;published&quot;
    	   		IO.put(&quot;Publish the post&quot;)
    	    	Map.put(post, :status, &quot;published&quot;)
        	true -&gt;
        		IO.put(&quot;Cannot update to #{status} from in_review&quot;)
        		post
        end
    end
    
    def update_status(%{status: &quot;published&quot;} = post, status) do
    	if status == &quot;draft&quot; do
        	IO.put(&quot;Unpublish the post&quot;)
        	Map.put(post, :status, &quot;draft&quot;)
        else
        	IO.put(&quot;Cannot update to #{status} from published&quot;)
        	post
        end
    end
end
</code></pre>

<p>**Vấn đề: **</p>

<ul>
<li><p>Code dài, khó mở rộng, dễ xảy ra lỗi</p></li>

<li><p>Nếu thêm nhiều trạng thái khác cho post, phải update toàn bộ các hàm <code>update_status</code></p></li>

<li><p>Nếu có nhiều cách chuyển đổi giữa các trạng thái, phải update toàn bộ</p></li>

<li><p>Làm sao biết từ trạng thái hiện tại có thể chuyển qua trạng thái nào khác?</p></li>

<li><p>Làm sao đảm bảo luồng dữ liệu/ logic chạy đúng</p></li>
</ul>

<h3 id="2-2-sử-dụng-fsm">2.2 Sử dụng FSM</h3>

<p>Trong ví dụ này sử dụng thư viện <a href="https://github.com/bluzky/as_fsm">as_fsm</a> hỗ trợ việc implement máy trạng thái trên ngôn ngữ elixir</p>

<pre><code class="language-elixir">defmodule Post do
  # define state, event and transition 
  use AsFsm,
    states: [:draft, :in_review, :published],
    events: [
      review: [
        name:     &quot;In review&quot;,
        from:     [:draft],
        to:       :in_review,
        on_transition: fn(post, params) -&gt; 
        	# thực ra việc gán trạng thái mới được tự động thực hiện bởi thư viện
        	# code này chỉ để mục đích cho dễ hiểu
        	post = Map.put(post, :status, :in_review)
        	{:ok, post}
        end
      ], 
      approve: [
        name:     &quot;Approve&quot;,
        from:     [:in_review],
        to:       :published
        on_transition: fn(post, params) -&gt; 
        	post = Map.put(post, :status, :published)
        	{:ok, post}
        end
      ], 
      reject: [
        name:     &quot;Reject&quot;,
        from:     [:in_review],
        to:       :draft,
        on_transition: fn(post, params) -&gt; 
        	post = Map.put(post, :status, :draft)
        	{:ok, post}
        end
      ],
      unpublish: [
        name:     &quot;Unpublish&quot;,
        from:     [:published],
        to:       :draft,
        on_transition: fn(post, params) -&gt; 
        	post = Map.put(post, :status, :draft)
        	{:ok, post}
        end
      ]
    ]
    
    defstruct content: &quot;sample content&quot;, status: &quot;draft&quot;
end

# gọi thực hiện 
iex &gt; post = %Post{content: &quot;test content&quot;, status: &quot;draft&quot;}
iex &gt; post = Post.review(post)
# hoac
iex &gt; post = Post.trigger(post, :review)
</code></pre>

<ul>
<li>Việc implement FSM cũng không quá phức tạp nhưng có thể tái sử dụng được nhiều lần</li>
<li>Việc thêm mới các trạng thái (state) hoặc các bước chuyển tiếp (transition) không cần thay đổi quá nhiều code</li>
<li>các luồng xử lý, event được thể hiện rõ trên cấu hình trạng thái</li>
</ul>

<h2 id="3-tham-khảo">3. Tham khảo</h2>

<ul>
<li><p>Học thêm về <a href="https://brilliant.org/wiki/finite-state-machines/">FSM trên Brilliant</a></p></li>

<li><p><a href="https://blog.4xxi.com/finite-state-machine-in-web-development-dc1dc6f67d7c">Finite-state machine in web-development</a></p></li>

<li><p>Thư viện FSM cho ecto model <a href="https://github.com/asiniy/ecto_state_machine">ecto_state_machine</a></p></li>

<li><p>Slide <a href="https://www.slideshare.net/EuropeanSharePointCommunity/th11-fitzmauricestate-machine-workflows?next_slideshow=1">State Machine Workflow: Esoteric Techniques &amp; Patterns</a></p></li>
</ul>

<p>​</p>

      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="http://bluzky.github.io/post/2018-04-11-blockchain/" data-toggle="tooltip" data-placement="top" title="Tìm hiểu về công nghệ Blockchain">&larr; Previous Post</a>
            </li>
          
          
        </ul>
      


      
        
        
      

    </div>
  </div>
</div>

    <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
          <li>
            <a href="mailto:bluesky.1289@gmail.com" title="Email me">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
          </li>
          <li>
            <a href="https://www.facebook.com/username" title="Facebook">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
          </li>
          <li>
            <a href="https://plus.google.com/&#43;username" title="Google&#43;">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-google-plus fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
          </li>
          <li>
            <a href="https://github.com/bluzky" title="GitHub">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
          </li>
          <li>
            <a href="https://gitlab.com/username" title="GitLab">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-gitlab fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
          </li>
          <li>
            <a href="https://twitter.com/username" title="Twitter">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
          </li>
          <li>
            <a href="https://reddit.com/u/username" title="Reddit">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-reddit-alien fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
          </li>
          <li>
            <a href="https://linkedin.com/in/username" title="LinkedIn">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
          </li> 
          <li>
            
            <a href="http://bluzky.github.io/index.xml" title="RSS">
            
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
        <p class="credits copyright text-muted">
           
          <a href="yourwebsite.com">Dũng Nguyễn</a>   &nbsp;&bull;&nbsp; 2018  &nbsp;&bull;&nbsp;
          <a href="http://bluzky.github.io/%20">The 54 tribes</a> 
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="http://gohugo.io">Hugo v0.32.4</a> powered &nbsp;&bull;&nbsp; Theme by <a href="http://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a> adapted to <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a> 
        </p>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.js" integrity="sha384-/y1Nn9+QQAipbNQWU65krzJralCnuOasHncUFXGkdwntGeSvQicrYkiUBwsgUqc1" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/contrib/auto-render.min.js" integrity="sha384-dq1/gEHSxPZQ7DdrM82ID4YVol9BYyU7GbWlIwnwyPzotpoc57wDw/guX8EaYGPx" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="http://bluzky.github.io/js/main.js"></script>

<script src="http://bluzky.github.io/js/prism.js"></script>

<script>
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe.min.js" integrity="sha256-UplRCs9v4KXVJvVY+p+RSo5Q4ilAUXh7kpjyIP5odyc=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe-ui-default.min.js" integrity="sha256-PWHOlUzc96pMc8ThwRIXPn8yH4NOLu42RQ0b9SpnpFk=" crossorigin="anonymous"></script>
<script src="http://bluzky.github.io/js/load-photoswipe.js"></script>

 


  </body>
</html>

