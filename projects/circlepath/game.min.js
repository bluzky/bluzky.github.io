var game,score=0,ballDistance=120,rotationSpeed=4,angleRange=[25,155],visibleTargets=7,bgColors=[6470936,16759552,16732928,13766708,16729948,9377458],acceptDistant=30;window.onload=function(){game=new Phaser.Game(640,960,Phaser.AUTO,"game-canvas"),game.state.add("PlayGame",playGame),game.state.add("Menu",menuState)};var gameManager=function(t){return this.game=t,this.start=function(){score=0,acceptDistant=30,this.game.state.start("PlayGame")},this.getScore=function(){return score},this}(game);menu.initialize(gameManager),menu.startMenu.show();var playGame=function(t){};playGame.prototype={preload:function(){game.load.image("ball","ball.png"),game.load.image("target","target.png"),game.load.image("arm","arm.png"),game.load.audio("end","start.wav"),game.load.audio("tap","tap.mp3"),game.scale.pageAlignHorizontally=!0,game.scale.pageAlignVertically=!0,game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL},create:function(){this.savedData=null==localStorage.getItem("circlepath")?{score:0}:JSON.parse(localStorage.getItem("circlepath")),this.hud=new Hud(game,this.savedData.score.toString()),this.hud.init(),this.destroy=!1,this.saveRotationSpeed=rotationSpeed,this.tintColor=bgColors[game.rnd.between(0,bgColors.length-1)];do this.tintColor2=bgColors[game.rnd.between(0,bgColors.length-1)];while(this.tintColor==this.tintColor2);game.stage.backgroundColor=this.tintColor,this.targetArray=[],this.steps=0,this.rotatingDirection=game.rnd.between(0,1),this.gameGroup=game.add.group(),this.targetGroup=game.add.group(),this.ballGroup=game.add.group(),this.gameGroup.add(this.targetGroup),this.gameGroup.add(this.ballGroup),this.arm=game.add.sprite(game.width/2,game.height/4*2.7,"arm"),this.arm.anchor.set(0,.5),this.arm.tint=this.tintColor2,this.ballGroup.add(this.arm),this.balls=[game.add.sprite(game.width/2,game.height/4*2.7,"ball"),game.add.sprite(game.width/2,game.height/2,"ball")],this.balls[0].anchor.set(.5),this.balls[0].tint=this.tintColor2,this.balls[1].anchor.set(.5),this.balls[1].tint=this.tintColor2,this.ballGroup.add(this.balls[0]),this.ballGroup.add(this.balls[1]),this.rotationAngle=0,this.rotatingBall=1;var t=game.add.sprite(0,0,"target");t.anchor.set(.5),t.x=this.balls[0].x,t.y=this.balls[0].y,this.targetGroup.add(t),this.targetArray.push(t),game.input.onDown.add(this.changeBall,this);for(var a=0;a<visibleTargets;a++)this.addTarget();this.tapSound=game.add.audio("tap"),this.endSound=game.add.audio("end")},update:function(){var t=this.balls[this.rotatingBall].position.distance(this.targetArray[1].position);t>90&&this.destroy&&this.steps>visibleTargets&&this.gameOver(),t<acceptDistant&&!this.destroy&&(this.destroy=!0),this.rotationAngle=(this.rotationAngle+this.saveRotationSpeed*(2*this.rotatingDirection-1))%360,this.arm.angle=this.rotationAngle+90,this.balls[this.rotatingBall].x=this.balls[1-this.rotatingBall].x-ballDistance*Math.sin(Phaser.Math.degToRad(this.rotationAngle)),this.balls[this.rotatingBall].y=this.balls[1-this.rotatingBall].y+ballDistance*Math.cos(Phaser.Math.degToRad(this.rotationAngle));var a=this.balls[1-this.rotatingBall].worldPosition.x-game.width/2,e=this.balls[1-this.rotatingBall].worldPosition.y-game.height/4*2.7;this.gameGroup.x=Phaser.Math.linearInterpolation([this.gameGroup.x,this.gameGroup.x-a],.05),this.gameGroup.y=Phaser.Math.linearInterpolation([this.gameGroup.y,this.gameGroup.y-e],.05)},changeBall:function(){this.destroy=!1;var t=this.balls[this.rotatingBall].position.distance(this.targetArray[1].position);if(t<acceptDistant){this.rotatingDirection=game.rnd.between(0,1);var a=game.add.tween(this.targetArray[0]).to({alpha:0},500,Phaser.Easing.Cubic.In,!0);a.onComplete.add(function(t){t.destroy()}),this.targetArray.shift(),this.arm.position=this.balls[this.rotatingBall].position,this.rotatingBall=1-this.rotatingBall,this.rotationAngle=this.balls[1-this.rotatingBall].position.angle(this.balls[this.rotatingBall].position,!0)-90,this.arm.angle=this.rotationAngle+90;for(var e=0;e<this.targetArray.length;e++)this.targetArray[e].alpha+=1/7;this.addTarget(),this.hud.increaseScore(1),score++,this.tapSound.play(),score>5&&(acceptDistant=Math.max(acceptDistant-2*score,20))}else this.gameOver()},addTarget:function(){this.steps++,startX=this.targetArray[this.targetArray.length-1].x,startY=this.targetArray[this.targetArray.length-1].y;var t=game.add.sprite(0,0,"target"),a=game.rnd.between(angleRange[0]+90,angleRange[1]+90);t.anchor.set(.5),t.x=startX+ballDistance*Math.sin(Phaser.Math.degToRad(a)),t.y=startY+ballDistance*Math.cos(Phaser.Math.degToRad(a)),t.alpha=1-this.targetArray.length*(1/7);var e={font:"bold 32px Arial",fill:"#"+this.tintColor.toString(16),align:"center"},i=game.add.text(0,0,this.steps.toString(),e);i.anchor.set(.5),t.addChild(i),this.targetGroup.add(t),this.targetArray.push(t)},gameOver:function(){localStorage.setItem("circlepath",JSON.stringify({score:Math.max(this.savedData.score,this.steps-visibleTargets)})),game.input.onDown.remove(this.changeBall,this),this.saveRotationSpeed=0,this.arm.destroy();var t=game.add.tween(this.balls[1-this.rotatingBall]).to({alpha:0},1e3,Phaser.Easing.Cubic.Out,!0),a=this;t.onComplete.add(function(){a.endSound.play(),menu.onloose(score),this.game.state.start("Menu")},this)}};var menuState=function(t){};menuState.prototype.update=function(){};var Hud=function(t,a){this.game=t,this.bestScore=a,this.score=0};Hud.prototype.init=function(){this.scoreBox=new ScoreBox(this.game,50,20,200,85,"SCORE",this.score),this.bestScoreBox=new ScoreBox(this.game,390,20,200,85,"BEST SCORE",this.bestScore)},Hud.prototype.increaseScore=function(t){this.score+=t,this.scoreBox.increaseScore(t)};var ScoreBox=function(t,a,e,i,s,r,o){this.game=t,this.score=o,this.label=r,this.padding=10,this.x=a,this.y=e,this.width=i,this.height=s,this.init()};ScoreBox.prototype.init=function(){var t=game.add.graphics(0,0);t.beginFill(0,.7),t.drawRect(this.x,this.y,this.width,this.height),t.endFill();var a={font:"bold 22px Arial",fill:"#ffffff"};this.labelText=this.game.add.text(this.x,this.y+this.padding,this.label,a),this.labelText.x=this.x+(this.width-this.labelText.width)/2;var e={font:"bold 32px Arial",fill:"#ffffff"};this.scoreText=this.game.add.text(this.x,this.y+this.padding+this.labelText.height,this.score+"",e),this.scoreText.x=this.x+(this.width-this.scoreText.width)/2},ScoreBox.prototype.setScore=function(t){this.score=t,this.scoreText.text=t+""},ScoreBox.prototype.increaseScore=function(t){this.score+=t,this.scoreText.text=this.score+""};