var _level=0,looseCount=0,Menu=function(){var n=function(n,e){this.container=document.getElementById(n),this._bindEvents(e)};return n.prototype._bindEvents=function(n){var e=this;Object.keys(n).map(function(t,o){var i=t.split(" "),s=i[0],r=i[1],a=e.container.querySelectorAll(r);"function"==typeof n[t]&&e._bindEvent(a,s,n[t])})},n.prototype._bindEvent=function(n,e,t){if(void 0==n.length)n.addEventListener(e,t);else for(var o=0;o<n.length;o++)this._bindEvent(n[o],e,t)},n.prototype.show=function(){document.body.style.overflow="hidden",this.container.style.display="block"},n.prototype.hide=function(){document.body.style.overflow="auto",this.container.style.display="none"},n.prototype.findFirst=function(n){var e=this.container.querySelectorAll(n);return e[0]||{}},n}(),MenuManager=function(){var n=function(){this.menuMap={}};return n.prototype.addMenu=function(n,e){this.menuMap[n]=e},n.prototype.removeMenu=function(n){delete this.menuMap[n]},n.prototype.get=function(n){return this.menuMap[n]},n.prototype.show=function(n){if(this.menuMap.hasOwnProperty(n)){for(var e in this.menuMap)this.menuMap[e].hide();this.menuMap[n].show()}},n.prototype.hideAll=function(){for(var n in this.menuMap)this.menuMap[n].hide()},n}(),GameMenu=function(){var n=function(){};return n.prototype.initialize=function(n){this.game=n,this.startMenu=new Menu("start-screen",{"click .js-btn-play":this.onstart.bind(this),"click .js-btn-help":function(){e.menuManager.show("help")}}),this.endMenu=new Menu("win-screen",{"click .js-btn-replay":this.onstart.bind(this),"click .js-btn-share":this.onshare.bind(this)});var e=this,t=new Menu("help-screen",{"click .js-btn-ok":function(){e.menuManager.show("startmenu")}});this.menuManager=new MenuManager,this.menuManager.addMenu("startmenu",this.startMenu),this.menuManager.addMenu("endmenu",this.endMenu),this.menuManager.addMenu("help",t)},n.prototype.onstart=function(){this.game.start(),this.menuManager.hideAll()},n.prototype.onloose=function(n){this.endMenu.findFirst(".js-score").innerHTML=n,this.menuManager.show("endmenu"),looseCount++;var n=this.game.getScore();window.setTimeout(function(){gotoSchem("mofiin://games/save_score?score="+n+"&level="+n,function(){})},100)},n.prototype.onshare=function(){gotoSchem("mofiin://games/share_score",function(){MofiinGame.shareFB({score:this.game.score})})},n}(),menu=new GameMenu;